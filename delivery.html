
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delivery Tracking - Nitya Sales</title>
    <style>
        :root {
            --primary-color: #1a73e8; --secondary-color: #28a745; --delivered-color: #6c757d;
            --light-gray: #f4f7f9; --dark-gray: #333; --white: #ffffff;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; background-color: var(--light-gray); }
        .header { background-color: var(--white); padding: 15px 30px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); display: flex; align-items: center; gap: 30px; }
        .header h1 { margin: 0; font-size: 1.5em; color: var(--primary-color); }
        nav a { text-decoration: none; color: var(--dark-gray); font-weight: 600; padding: 8px 12px; border-radius: 6px; }
        nav a:hover, nav a.active { background-color: var(--light-gray); color: var(--primary-color); }
        .container { max-width: 1200px; margin: 20px auto; padding: 0 20px; }
        .section-title { font-size: 1.8em; color: var(--dark-gray); margin-bottom: 20px; border-bottom: 2px solid var(--primary-color); padding-bottom: 10px; }
        .order-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; margin-bottom: 40px; }
        .order-card { background-color: var(--white); border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); padding: 20px; }
        .order-card h3 { margin-top: 0; font-size: 1.2em; }
        .total-amount { font-size: 1.4em; font-weight: bold; color: var(--primary-color); text-align: right; margin: 10px 0; }
        .order-items { list-style-type: none; padding-left: 0; }
        .order-items li { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #eee; }
        .status { font-weight: bold; padding: 4px 8px; border-radius: 4px; color: white; }
        .status.delivery { background-color: #ff8c00; }
        .status.delivered { background-color: var(--delivered-color); }
        .mark-delivered-btn { width: 100%; padding: 12px; margin-top: 15px; background-color: var(--secondary-color); color: white; border: none; border-radius: 6px; font-size: 1em; cursor: pointer; }
        #no-orders-msg, #no-history-msg { text-align: center; font-size: 1.2em; color: #888; padding: 50px; }
    </style>
</head>
<body>
    <header class="header">
        <h1>Nitya Sales</h1>
        <nav>
            <a href="inventory.html">Inventory</a>
            <a href="delivery.html" class="active">Deliveries</a>
        </nav>
    </header>

    <main class="container">
        <h2 class="section-title">Out for Delivery</h2>
        <div class="order-grid" id="deliveryGrid"></div>

        <h2 class="section-title">Delivery History</h2>
        <div class="order-grid" id="historyGrid"></div>
    </main>

    <script>
        const API_URL = 'http://localhost:3001/api';
        const deliveryGrid = document.getElementById('deliveryGrid');
        const historyGrid = document.getElementById('historyGrid');

        // Reusable function to create an order card
        function createOrderCard(order) {
            let itemsHtml = '<ul class="order-items">';
            order.items.forEach(item => {
                itemsHtml += `<li><span>${item.name} (x${item.quantity})</span><span>₹${(item.price * item.quantity).toLocaleString('en-IN')}</span></li>`;
            });
            itemsHtml += '</ul>';

            const card = document.createElement('div');
            card.className = 'order-card';
            card.innerHTML = `
                <h3>Order ID: ${order.id} for ${order.customer_name}</h3>
                <p><strong>Address:</strong> ${order.delivery_address}</p>
                ${itemsHtml}
                <p class="total-amount">Total: ₹${parseFloat(order.total_amount).toLocaleString('en-IN')}</p>
                <p><strong>Status:</strong> 
                    <span class="status ${order.status === 'Delivered' ? 'delivered' : 'delivery'}">${order.status}</span>
                </p>
                ${order.status === 'Out for Delivery' ? `<button class="mark-delivered-btn" data-id="${order.id}">Mark as Delivered</button>` : ''}
            `;
            return card;
        }

        async function fetchAllOrders() {
            try {
                const response = await fetch(`${API_URL}/orders`);
                const data = await response.json();
                
                deliveryGrid.innerHTML = '';
                historyGrid.innerHTML = '';

                // Populate Out for Delivery
                if (data.outForDelivery.length === 0) {
                    deliveryGrid.innerHTML = '<p id="no-orders-msg">No items are currently out for delivery.</p>';
                } else {
                    data.outForDelivery.forEach(order => {
                        deliveryGrid.appendChild(createOrderCard(order));
                    });
                }
                
                // Populate Delivery History
                if (data.delivered.length === 0) {
                    historyGrid.innerHTML = '<p id="no-history-msg">No completed deliveries yet.</p>';
                } else {
                    data.delivered.forEach(order => {
                        historyGrid.appendChild(createOrderCard(order));
                    });
                }
                
                attachButtonListeners();

            } catch (err) {
                deliveryGrid.innerHTML = '<p>Error loading delivery data.</p>';
            }
        }

        function attachButtonListeners() {
            document.querySelectorAll('.mark-delivered-btn').forEach(button => {
                button.addEventListener('click', async () => {
                    button.disabled = true; // Prevent double clicks
                    const id = button.dataset.id;
                    try {
                        await fetch(`${API_URL}/orders/${id}/deliver`, { method: 'PUT' });
                        fetchAllOrders(); // Refresh both lists
                    } catch (err) {
                        alert('Failed to update order status.');
                        button.disabled = false;
                    }
                });
            });
        }

        fetchAllOrders();
    </script>
</body>
</html>
```

---
### Step 3: Add Navigation to Your Other Pages

For a consistent experience, let's add the same navigation header to your other main pages.

**1. Update `inventory.html`:**
Replace the `<header>` section in `inventory.html` with this:
```html
<header class="header">
    <h1>Nitya Sales</h1>
    <nav>
        <a href="inventory.html" class="active">Inventory</a>
        <a href="delivery.html">Deliveries</a>
    </nav>
    <button class="add-product-btn" id="addProductBtn">Add New Product</button>
</header>
```

**2. Update `edit-product.html`:**
Replace the `<header>` section in `edit-product.html` with this:
```html
<header class="header">
    <h1>Nitya Sales</h1>
    <nav>
        <a href="inventory.html">Inventory</a>
        <a href="delivery.html">Deliveries</a>
    </nav>
</header>

